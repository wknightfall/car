<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="icon" href="__IMG__/pub/t_logo.gif" type="image/x-icon"/>
    <meta name="viewport" content="initial-scale=1, maximum-scale=3, minimum-scale=1, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="Keywords" content="">
    <meta name="description" content="">
    <meta charset="UTF-8">
    <title>{:C('WEB_SITE_TITLE')}</title>
    <link type="text/css" href="__CSS__/main.css" rel="stylesheet" />
    <link type="text/css" href="__CSS__/mer.css" rel="stylesheet" />
    <script type="text/javascript" src="__JS__/jquery-1.9.1.min.js"></script>
    <script type="text/javascript" src="__JS__/public.js"></script>
    <script type="text/javascript" src="__JS__/person.js"></script>
    <script type="text/javascript" src="__PUBLIC__/layer/layer.js"></script>
    <script type="text/javascript" src="__JS__/ajaxupload.3.5.js" ></script>
    <script type="text/javascript" src="__PUBLIC__/layer/layer.js"></script>
    <script type="text/javascript" src="__STATIC__/uploadify/jquery.uploadify.min.js"></script>
   <!--富文本编辑器-->
    <link rel="stylesheet" href="/Public/Home/kindeditor/themes/default/default.css" />
    <script charset="utf-8" src="/Public/Home/kindeditor/kindeditor-all-min.js"></script>
    <script charset="utf-8" src="/Public/Home/kindeditor/lang/zh-CN.js"></script>


</head>
<body><include file="Public/zx" />
<!--标题信息栏-->
<div class="her_imsg">
    <include file="Public/header" />
</div>

<!--顶部菜单-->
<div class="heda_nav">
    <include file="Public/nav" />
</div>
<!--分割线-->
<div class="split_line"></div>
<!--当前位置-->
<!-- >>>>>>>>>main<<<<<<<<<<< -->
<section>
    <div class="psc_mb">
        <div class="perle_list">
            <div class="txkk_bor">
                <div class="txkk_bod" style="background: url('{$user.avatar}')"></div>
                <div class="name_id">
                    <p>{$user.name}</p>
                    <em>ID:{$user.id}</em>
                </div>
            </div>
            <div class="list_per">
                <ul>
                    <a href="{:U('mer/luntan')}"><li><span><p>我的论坛</p></span></li></a>
                    <a href="{:U('mer/message')}"><li><span><p>我的留言</p></span></li></a>
                    <a href="{:U('mer/goods?issale=2')}"><li  class="per_chd" ><span><p>商品管理</p></span></li></a>
                    <a href="{:U('mer/youhui')}"><li><span><p>优惠活动</p></span></li></a>
                    <a href="{:U('mer/dingdan?isover=2')}"><li><span><p>订单管理</p></span></li></a>
                    <a href="{:U('mer/caiwu')}"><li><span><p>财务</p></span></li></a>
                    <a href="{:U('mer/shangjia')}"><li><span><p>商家信息</p></span></li></a>
                </ul>
            </div>
        </div>
        <!---->
        <div class="perrg_imsg">
            <!--订单部分-->
            <div class="fabu_ssp">
                <!--商品管理-->
                <div class="per_spgl">菜品管理</div>
                <!---->
                <div class="list_texs">
                 <!--   <ul>
                        <li>优惠券类型</li>
                        <li>
                            <div class="sele_ll sele_ee">满减优惠券</div>
                            <div class="sele_chd">
                                <ul>
                                    <li>11满减优惠券</li>
                                    <li>22满减优惠券</li>
                                    <li>33满减优惠券</li>
                                    <li>44满减优惠券</li>
                                </ul>
                            </div>
                        </li>
                    </ul>-->
                    <ul>
                        <li>菜品名称：</li>
                        <li><input type="text" name="name" id='name' value="{$vo.name}"></li>

                    </ul>
                    <ul>
                        <li>菜品简介：</li>
                        <li><input type="text" name="content" id='content' value="{$vo.content}"></li>
                    </ul>
                    <ul>
                        <li>菜品数量：</li>
                        <li><input type="text" name="num" id='num' value="{$vo.roomnum}"></li>
                    </ul>
                    <ul>
                        <li>菜品价格：</li>
                        <li><input type="text" name="price" id='price'  value="{$vo.price}"></li>
                       <!-- <li>优惠价：</li>
                        <li><input type="text" name="cheapprice" id='cheapprice'  value="{$vo.cheapprice}"></li>-->
                    </ul>
                   <!-- <ul class="add_ul">
                        <li>房间属性：</li>
                        <li><input type="text" ></li>
                        <li>房间价格：</li>
                        <li><input type="text" ></li>
                        <li class="add_rum"></li>
                    </ul>-->
                    <ul>
                        <li>菜品主图：</li>
                        <li class="room_pht">
                            <div id="icon"><img id="iconimg" style="width:108px;height:98px;" src="{$vo.icon|picture}"></div>

                            <em>(上传图片尺寸为750*615，大小不超过2M)</em>
                            <input type="hidden" name="iconid" value="{$vo.icon}">
                        </li>
                    </ul>
                    <ul>
                        <li>菜品详情：</li>
                        <li>
                            <!---->
                            <textarea  name="detail"  id="detail" style="width:700px;height:200px;visibility:hidden;display: block;"> {$vo.detail}</textarea>
                            <script>
                                var editor;
                                KindEditor.ready(function(K) {
                                    editor = K.create('textarea[name="detail"]', {
                                        allowImageUpload:false,
                                        resizeType:1,
                                        width:"100%",
                                        height:"450px",
                                        afterBlur: function(){this.sync();}//失去焦点，同步信息数据
                                        /*
                                        newlineTag : "br",
                                        resizeType : 2,
                                        allowPreviewEmoticons : true,
                                        allowImageUpload : true,
                                        minHeight:"100px",
                                        autoHeightMode : false,
                                        afterCreate : function() {
                                            this.loadPlugin('autoheight');
                                        },
                                        items : [
                                            'fullscreen', 'source' , 'table',
                                            'insertfile', 'link' , 'image' , 'emoticons' , '|' , 'forecolor', 'hilitecolor', 'bold' ,'underline', 'removeformat', '|' ,
                                            'justifyleft', 'justifycenter', 'justifyright', 'preview']
                                        */
                                    });
                                });
                            </script>
                            <!---->
                        </li>
                    </ul>
                    <input type="button" value="保存" class="baoc_btn" id="submit">
                </div>
                <!---->
            </div>
        </div>
    </div>
</section>


<!-------底部--------->
<include file="Public/footer" />


</body>
<script>


    $(document).on("click","#submit",function () {
        var name = $('input[name=name]').val()
        var content = $('input[name=content]').val()
        var price = $('input[name=price]').val()
        //var cheapprice = $('input[name=cheapprice]').val()
        var detail = $('#detail').val()
        var num = $('input[name=num]').val()
        var icon = $('input[name=iconid]').val()

        var isnum = /^\d+$/;
        if(name==""){
            layer.tips('请输入内容', '#name', {
                tips: [1, '#3595CC'],
                time: 4000
            });return false;
         }
        if(content==""){
            layer.tips('请输入内容', '#content', {
                tips: [1, '#3595CC'],
                time: 4000
            });return false;
        }
        if(price==""){
            layer.tips('请输入内容', '#price', {
                tips: [1, '#3595CC'],
                time: 4000
            });return false;
        }
       /* if(cheapprice==""){
            layer.tips('请输入内容', '#cheapprice', {
                tips: [1, '#3595CC'],
                time: 4000
            });return false;
        }*/
        if(detail==""){
            layer.tips('请输入内容', '#detail', {
                tips: [1, '#3595CC'],
                time: 4000
            });return false;
        }
        if(num==""){
            layer.tips('请输入内容', '#num', {
                tips: [1, '#3595CC'],
                time: 4000
            });return false;
        }
        if(icon==""){
            layer.tips('请选择菜品图片', '#icon', {
                tips: [1, '#3595CC'],
                time: 4000
            });return false;
        }

        if(!isnum.test(price)){
            layer.tips('价格必须是数字', '#price', {
                tips: [1, '#3595CC'],
                time: 4000
            });return false;
        }
        if(!isnum.test(cheapprice)){
            layer.tips('价格必须是数字', '#cheapprice', {
                tips: [1, '#3595CC'],
                time: 4000
            });return false;
        }
        var id="{$Think.get.id}"
        $.post("/Home/mer/addfood",{'id':id,'name':name,'content':content,'price':price,'detail':detail,'num':num,'icon':icon},function(da){

            var obj = jQuery.parseJSON(da);
            if(obj.code==200){
                alert('addok');return;
                layer.msg('操作成功',function () {
                    location.href='/home/mer/goods?issale='+2;
                })
            }else{
                layer.msg('操作失败')

            }
        });
    })

    $(document).on("click","#gotopage",function () {

        var page = $('#pagenum').val();
        if(/^\d+$/.test(page)){

        }else{
            layer.msg('页码必要是数字！');
            return;
        }
        var url=location.href

        var a=url.split('/')
        a.pop()
        var c=a.join('/');

        var u=c+'/'+page+'.html'
        location.href=u

    })

</script>
<script>
    $(document).ready(function(){
        uploadsasa();
    });
    //上传头像
    function uploadsasa(){
        ajaxUploadicon(
                'icon', //上传的按钮id名称
                1000000000,  //允许上传的文件大小（单位：kb）
                '/Home/Public/upload?form_name=userfile&file_size=10000', //提交服务器端地址
                'userfile', //提交服务器文件表单名称
                "$(\".img_div\").show();$(\"#img_path\").attr('src', obj.filename);$(\"#is_upload\").val('1');", //上传成功后执行的 js callback
                'loadimg'  //loading 图片id
        );
    }

    function ajaxUploadicon(id_name, filesize, url, filename, callback, loadingid) {
        var index;
        var button = $('#'+id_name), interval;
        var fileType = "pic", fileNum = "one";
        new AjaxUpload(button,{
            action: url,
            name: filename,
            onSubmit : function(file, ext){
                index = layer.load(1, {
                    shade: [0.4,'#000000']
                });
                if(fileType == "pic") {
                    if (ext && /^(jpg|png|gif|jpeg)$/.test(ext)){
                        this.setData({
                            'info': '上传类型为图片'
                        });

                    } else {
                        alert('提示：您上传的是非图片类型！');
                        layer.close(index);
                        return false;
                    }
                }
                $("#"+loadingid).show();
                if(fileNum == 'one') this.disable();
            },
            onComplete: function(file, response){

                layer.close(index);
                var obj = jQuery.parseJSON(response);
                if (obj['ok'] == 'ok') {
                    $('#iconimg').attr('src',obj['filename']).show();
                    $('input[name=iconid]').val(obj['id']);

                    uploadsasa();
                } else {
                    switch (response) {
                        case '1':
                            alert('提示：上传失败，图片不能大于100M');

                            break;
                        case '3':
                            alert('提示：图片只有部分文件被上传，请重新上传！');

                            break;
                        case '4':
                            alert('提示：没有任何文件被上传！');

                            break;
                        case '5':
                            alert('提示：非图片类型，请上传jpg|png|gif图片！');

                            break;
                        default:
                            alert('提示：上传失败，错误未知，请您及时联系网站客服人员！');

                            break;
                    }
                }
                $("#"+loadingid).hide();
                window.clearInterval(interval);
                this.enable();
            }
        });
    }
</script>
</html>